<div class="container-fluid">
  <h1 class="mb-4">My Quiz History</h1>

  <div class="card">
    <div class="card-body">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>Quiz Title</th>
            <th>Category</th>
            <th>Date Taken</th>
            <th>Score</th>
            <th>Percentage</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let attempt of pagedHistory">
            <td><strong>{{ getQuizTitle(attempt.quizId) }}</strong></td>
            <td>{{ getQuizCategory(attempt.quizId) }}</td>
            <td>{{ attempt.date | date:'longDate' }}</td>
            <td>{{ attempt.score }} / {{ attempt.totalQuestions }}</td>
            <td>
              <div class="progress" style="height: 20px;">
                <div class="progress-bar" role="progressbar" [style.width.%]="getPercentage(attempt)"
                  [attr.aria-valuenow]="getPercentage(attempt)">
                  {{ getPercentage(attempt) | number:'1.0-0' }}%
                </div>
              </div>
            </td>
            <td>
              <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#quizInfoModal"
                (click)="selectQuizForInfo(attempt)">
                View Stats
              </button>
            </td>
          </tr>
          <tr *ngIf="history.length === 0">
            <td colspan="6" class="text-center p-4">You have not attempted any quizzes yet.</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="card-footer" *ngIf="history.length > 0">
      <nav>
        <ul class="pagination justify-content-center mb-0">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" href="#" (click)="$event.preventDefault(); changePage(currentPage - 1)">Previous</a>
          </li>
          <li class="page-item" *ngFor="let page of pages" [class.active]="currentPage === page">
            <a class="page-link" href="#" (click)="$event.preventDefault(); changePage(page)">{{ page }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" href="#" (click)="$event.preventDefault(); changePage(currentPage + 1)">Next</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<app-quiz-info-modal [selectedAttempt]="selectedAttempt"
  [selectedQuiz]="getQuizById(selectedAttempt?.quizId)"></app-quiz-info-modal>